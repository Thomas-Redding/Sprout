<script src="search.js"></script>
<script>

var search;
onload = () => {
  var div = document.getElementById('lorem');
  div.classList.add('search');
  search = new Search(div);
  search.onchange = (value) => {
    spr.send('query\t' + value);
  }
  spr.receive = (message) => {
    var i = message.indexOf('\t');
    if (i == -1) i = message.length;
    var command = message.substr(0, i);
    var arg = null;
    try {
      arg = JSON.parse(message.substr(i+1));
    } catch (err) {}
    if (command == 'suggestions') {
      search.setSuggestions(arg);
    } else if (command == 'clear') {
      search.setSuggestions([]);
    }
  };
  search.onsubmit = (value) => {
    search.setSuggestions([]);
    search.setValue('');
    spr.send('submit\t' + value);
  }
  spr.hotkeyCallbacks = [(c, keyCode, cmd, opt, ctrl, shift) => {
    var s = '';
    if (cmd) s += 'cmd+';
    if (opt) s += 'opt+';
    if (ctrl) s += 'ctrl+';
    if (shift) s += 'shift+';
    s += c;
  }];
}

function disableSmartPunctuationForTextInput(element) {
  // https://stackoverflow.com/a/49139933
  var conversionMap = {};
  conversionMap[ 0x2018 ] = '\'';
  conversionMap[ 0x201B ] = '\'';
  conversionMap[ 0x201C ] = '"';
  conversionMap[ 0x201F ] = '"';
  conversionMap[ 0x2019 ] = '\'';
  conversionMap[ 0x201D ] = '\"';
  conversionMap[ 0x2032 ] = '\'';
  conversionMap[ 0x2033 ] = '"';
  conversionMap[ 0x2035 ] = '\'';
  conversionMap[ 0x2036 ] = '"';
  conversionMap[ 0x2014 ] = '-';
  conversionMap[ 0x2013 ] = '-';
  element.addEventListener('keypress', (event) => {
    if( event.key.length != 1 ) return;
    var code = event.key.codePointAt(0);
    var replacement = conversionMap[code];
    if (replacement) {
      event.preventDefault();
      element.value = element.value.substr(0, lorem.selectionStart) + replacement + element.value.substr(lorem.selectionEnd);
      document.execCommand( 'insertText', 0, replacement );
    }
  });
}

</script>
<style>
body {
  margin: 0;
  background-color: none;
}
.search > input {
  display: block;
  width: 100%;
  background-color: #333;
  color: white;
  border: none;
  font-size: 2em;
  margin: 0;
}
.search > table {
  background-color: #444;
  color: white;
  width: 100%;
  border-collapse: collapse;
  cursor: pointer;
  font-size: 2em;
}
.search > table > tbody > tr.selected {
  background-color: #222;
}
</style>
<div id="lorem"></div>